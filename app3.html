<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMPLOYMENT CORNER - FERNANDINO! Tara Magobra</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Add EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        // Initialize EmailJS with your public key
        (function() {
            emailjs.init("YOUR_PUBLIC_KEY"); // Replace with your actual EmailJS public key
        })();
    </script>
    <style>
        /* All your existing CSS styles remain here */
        /* ... (keeping all the CSS the same) ... */
    </style>
</head>
<body>
    <div class="app-container">
        <!-- All your existing HTML structure remains the same -->
        <!-- ... (keeping all the HTML the same) ... -->
    </div>
    
    <!-- Camera Modal for Profile Picture -->
    <div class="camera-modal" id="camera-modal">
        <div class="camera-container">
            <video class="camera-preview" id="camera-preview" autoplay></video>
            <div class="camera-actions">
                <button class="camera-btn camera-cancel" onclick="closeCamera()">Cancel</button>
                <button class="camera-btn camera-capture" onclick="capturePhoto()">Capture</button>
            </div>
        </div>
    </div>
    
    <!-- Chat Toggle Button -->
    <div class="chat-toggle" id="chat-toggle">
        <i class="fas fa-comments"></i>
    </div>
    
    <!-- Chat Container -->
    <div class="chat-container" id="chat-container">
        <div class="chat-header">
            <div class="chat-title">Chat</div>
            <div class="chat-close" id="chat-close">
                <i class="fas fa-times"></i>
            </div>
        </div>
        <div class="chat-messages" id="chat-messages">
            <!-- Messages will be dynamically added here -->
        </div>
        <div class="chat-input-container">
            <input type="text" class="chat-input" id="chat-input" placeholder="Type a message...">
            <button class="chat-send" id="chat-send">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
    
    <script>
        // Enhanced Application State
        let currentUser = null;
        let currentUserType = null;
        let currentSection = 'auth-section';
        let previousSection = null;
        let currentCategory = 'all';
        let currentApplicantFilter = 'all';
        let userAccounts = JSON.parse(localStorage.getItem('userAccounts')) || [];
        let currentResumeFile = null;
        let currentApplicationResumeFile = null;
        let savedApplicants = JSON.parse(localStorage.getItem('savedApplicants')) || [];
        let scheduledInterviews = JSON.parse(localStorage.getItem('scheduledInterviews')) || [];
        let chatMessages = JSON.parse(localStorage.getItem('chatMessages')) || {};
        let currentChatWith = null;
        
        // Application data storage
        let submittedApplications = JSON.parse(localStorage.getItem('submittedApplications')) || {};
        let notifications = JSON.parse(localStorage.getItem('notifications')) || [];
        
        // DOM Elements
        const authSection = document.getElementById('auth-section');
        const userTypeSection = document.getElementById('user-type-section');
        const applicantView = document.getElementById('applicant-view');
        const employeeView = document.getElementById('employee-view');
        const myApplicationsView = document.getElementById('my-applications-view');
        const savedJobsView = document.getElementById('saved-jobs-view');
        const profileView = document.getElementById('profile-view');
        const editProfileView = document.getElementById('edit-profile-view');
        const jobDetailsView = document.getElementById('job-details-view');
        const applicationFormView = document.getElementById('application-form-view');
        const interviewSchedulingView = document.getElementById('interview-scheduling-view');
        const applicationDetailsView = document.getElementById('application-details-view');
        const applicantDetailsView = document.getElementById('applicant-details-view');
        
        const notificationPanel = document.getElementById('notification-panel');
        const searchPanel = document.getElementById('search-panel');
        const jobCardsContainer = document.getElementById('job-cards-container');
        const applicantsContainer = document.getElementById('applicants-container');
        const homeNavBtn = document.getElementById('home-nav-btn');
        const integrationStatus = document.getElementById('integration-status');
        
        // Chat Elements
        const chatToggle = document.getElementById('chat-toggle');
        const chatContainer = document.getElementById('chat-container');
        const chatClose = document.getElementById('chat-close');
        const chatMessagesEl = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSend = document.getElementById('chat-send');
        
        // Camera Elements
        const cameraModal = document.getElementById('camera-modal');
        const cameraPreview = document.getElementById('camera-preview');
        let cameraStream = null;
        
        // Job data by category
        const jobData = {
            all: [
                {
                    id: 'customer-service',
                    title: "CUSTOMER SERVICE REPRESENTATIVE",
                    company: "ALORICA",
                    location: "Clark",
                    salary: "₱18,000 - ₱22,000",
                    type: "Full Time",
                    image: "https://placehold.co/600x400/3b82f6/white?text=ALORICA"
                },
                {
                    id: 'marketing-specialist',
                    title: "MARKETING SPECIALIST",
                    company: "FAVERTON GROUP INC.",
                    location: "San Fernando",
                    salary: "₱20,000 - ₱25,000",
                    type: "Full Time",
                    image: "https://placehold.co/600x400/10b981/white?text=FAVERTON"
                },
                {
                    id: 'sales-associate',
                    title: "SALES ASSOCIATE",
                    company: "RC COLA",
                    location: "Pampanga",
                    salary: "₱12,000 - ₱15,000",
                    type: "Part Time",
                    image: "https://placehold.co/600x400/f59e0b/white?text=RC+COLA"
                }
            ],
            tech: [
                {
                    id: 'software-developer',
                    title: "SOFTWARE DEVELOPER",
                    company: "TECH SOLUTIONS INC.",
                    location: "Angeles City",
                    salary: "₱25,000 - ₱40,000",
                    type: "Full Time",
                    image: "https://placehold.co/600x400/3b82f6/white?text=TECH"
                },
                {
                    id: 'it-support',
                    title: "IT SUPPORT SPECIALIST",
                    company: "DATA SYSTEMS CORP",
                    location: "San Fernando",
                    salary: "₱18,000 - ₱25,000",
                    type: "Full Time",
                    image: "https://placehold.co/600x400/10b981/white?text=IT"
                }
            ],
            marketing: [
                {
                    id: 'digital-marketing',
                    title: "DIGITAL MARKETING SPECIALIST",
                    company: "CREATIVE AGENCY",
                    location: "Mexico",
                    salary: "₱20,000 - ₱30,000",
                    type: "Full Time",
                    image: "https://placehold.co/600x400/ef4444/white?text=MARKETING"
                },
                {
                    id: 'social-media',
                    title: "SOCIAL MEDIA MANAGER",
                    company: "BRAND BUILDERS INC",
                    location: "Angeles City",
                    salary: "₱18,000 - ₱25,000",
                    type: "Full Time",
                    image: "https://placehold.co/600x400/f59e0b/white?text=SOCIAL+MEDIA"
                }
            ],
            sales: [
                {
                    id: 'sales-rep',
                    title: "SALES REPRESENTATIVE",
                    company: "SALES PROS INC",
                    location: "San Fernando",
                    salary: "₱15,000 - ₱25,000 + Commission",
                    type: "Full Time",
                    image: "https://placehold.co/600x400/3b82f6/white?text=SALES"
                }
            ],
            finance: [
                {
                    id: 'accounting-assistant',
                    title: "ACCOUNTING ASSISTANT",
                    company: "FINANCE GROUP",
                    location: "Angeles City",
                    salary: "₱18,000 - ₱22,000",
                    type: "Full Time",
                    image: "https://placehold.co/600x400/10b981/white?text=FINANCE"
                }
            ]
        };
        
        // Applicant data for employee view
        const applicantData = {
            all: [
                {
                    name: "Maria Santos",
                    position: "Customer Service Representative",
                    experience: "3 years in customer service",
                    skills: ["Communication", "Problem Solving", "MS Office"],
                    status: "pending",
                    phone: "+63 912 345 6789",
                    email: "maria.santos@example.com",
                    appliedDate: "2023-03-15"
                },
                {
                    name: "John Doe",
                    position: "Customer Service Representative", 
                    experience: "5 years in call center",
                    skills: ["Customer Support", "Phone Etiquette", "CRM"],
                    status: "approved",
                    phone: "+63 923 456 7890",
                    email: "john.doe@example.com",
                    appliedDate: "2023-03-10"
                },
                {
                    name: "Anna Reyes",
                    position: "Marketing Specialist",
                    experience: "4 years in marketing",
                    skills: ["Digital Marketing", "Social Media", "Content Creation"],
                    status: "rejected",
                    phone: "+63 934 567 8901",
                    email: "anna.reyes@example.com",
                    appliedDate: "2023-03-05"
                },
                {
                    name: "Michael Tan",
                    position: "Sales Associate",
                    experience: "2 years in retail sales",
                    skills: ["Sales", "Negotiation", "Customer Relations"],
                    status: "pending",
                    phone: "+63 945 678 9012",
                    email: "michael.tan@example.com",
                    appliedDate: "2023-03-12"
                }
            ],
            pending: [
                {
                    name: "Maria Santos",
                    position: "Customer Service Representative",
                    experience: "3 years in customer service",
                    skills: ["Communication", "Problem Solving", "MS Office"],
                    status: "pending",
                    phone: "+63 912 345 6789",
                    email: "maria.santos@example.com",
                    appliedDate: "2023-03-15"
                },
                {
                    name: "Michael Tan",
                    position: "Sales Associate",
                    experience: "2 years in retail sales",
                    skills: ["Sales", "Negotiation", "Customer Relations"],
                    status: "pending",
                    phone: "+63 945 678 9012",
                    email: "michael.tan@example.com",
                    appliedDate: "2023-03-12"
                }
            ],
            approved: [
                {
                    name: "John Doe",
                    position: "Customer Service Representative", 
                    experience: "5 years in call center",
                    skills: ["Customer Support", "Phone Etiquette", "CRM"],
                    status: "approved",
                    phone: "+63 923 456 7890",
                    email: "john.doe@example.com",
                    appliedDate: "2023-03-10"
                }
            ],
            rejected: [
                {
                    name: "Anna Reyes",
                    position: "Marketing Specialist",
                    experience: "4 years in marketing",
                    skills: ["Digital Marketing", "Social Media", "Content Creation"],
                    status: "rejected",
                    phone: "+63 934 567 8901",
                    email: "anna.reyes@example.com",
                    appliedDate: "2023-03-05"
                }
            ]
        };
        
        // Initialize the application
        function init() {
            showSection('auth-section');
            populateJobCards('all');
            populateApplicantCards('all');
            
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                currentUserType = currentUser.type;
                showHomeSection();
                updateProfileInfo();
            }
            
            // Set default interview date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('interview-date').valueAsDate = tomorrow;
            
            // Initialize SMS preview
            updateSmsPreview();
            
            // Load notifications
            loadNotifications();
            
            // Initialize chat
            initChat();
        }
        
        // Show home section based on user type
        function showHomeSection() {
            if (currentUserType === 'applicant') {
                showSection('applicant-view');
            } else {
                showSection('employee-view');
            }
            homeNavBtn.classList.add('active');
        }
        
        // Show a specific section and hide others
        function showSection(sectionId) {
            // Hide all sections
            authSection.classList.add('hidden');
            userTypeSection.classList.add('hidden');
            applicantView.classList.add('hidden');
            employeeView.classList.add('hidden');
            myApplicationsView.classList.add('hidden');
            savedJobsView.classList.add('hidden');
            profileView.classList.add('hidden');
            editProfileView.classList.add('hidden');
            jobDetailsView.classList.add('hidden');
            applicationFormView.classList.add('hidden');
            interviewSchedulingView.classList.add('hidden');
            applicationDetailsView.classList.add('hidden');
            applicantDetailsView.classList.add('hidden');
            
            // Hide panels
            notificationPanel.style.display = 'none';
            searchPanel.style.display = 'none';
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show the requested section
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update navigation button states
            if (sectionId === 'applicant-view' || sectionId === 'employee-view') {
                homeNavBtn.classList.add('active');
            } else if (sectionId === 'my-applications-view') {
                document.querySelector('.nav-btn:nth-child(2)').classList.add('active');
            } else if (sectionId === 'saved-jobs-view') {
                document.querySelector('.nav-btn:nth-child(3)').classList.add('active');
                
                // Show appropriate saved items based on user type
                if (currentUserType === 'applicant') {
                    document.getElementById('applicant-saved-jobs').classList.remove('hidden');
                    document.getElementById('employee-saved-applicants').classList.add('hidden');
                } else {
                    document.getElementById('applicant-saved-jobs').classList.add('hidden');
                    document.getElementById('employee-saved-applicants').classList.remove('hidden');
                }
            } else if (sectionId === 'profile-view') {
                document.querySelector('.nav-btn:nth-child(4)').classList.add('active');
            }
            
            // Update previous section
            previousSection = currentSection;
            currentSection = sectionId;
        }
        
        // Go back to previous section
        function goBack() {
            if (previousSection) {
                showSection(previousSection);
            } else {
                showHomeSection();
            }
        }
        
        // Login function
        function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (email && password) {
                // Check if user exists
                const user = userAccounts.find(acc => acc.email === email && acc.password === password);
                
                if (user) {
                    currentUser = user;
                    currentUserType = user.type;
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    
                    // Update profile information
                    updateProfileInfo();
                    
                    // Show appropriate view based on user type
                    showHomeSection();
                    
                    // Refresh job cards to show application status
                    populateJobCards(currentCategory);
                } else {
                    alert('Invalid email or password');
                }
            } else {
                alert('Please enter both email and password');
            }
        }
        
        // Sign up function
        function signup() {
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirm = document.getElementById('signup-confirm').value;
            
            if (name && email && password && confirm) {
                // Check email format
                if (!isValidEmail(email)) {
                    alert('Please enter a valid email address (e.g., name@gmail.com)');
                    return;
                }
                
                if (password !== confirm) {
                    alert('Passwords do not match');
                    return;
                }
                
                // Check if email already exists
                if (userAccounts.some(acc => acc.email === email)) {
                    alert('Email already registered');
                    return;
                }
                
                // Create new user (user type will be selected later)
                const newUser = {
                    name: name,
                    email: email,
                    password: password,
                    type: null, // Will be set when user selects type
                    phone: '',
                    address: '',
                    location: '',
                    about: '',
                    skills: [],
                    education: [],
                    experience: [],
                    profilePicture: null
                };
                
                userAccounts.push(newUser);
                localStorage.setItem('userAccounts', JSON.stringify(userAccounts));
                
                // Show user type selection
                currentUser = newUser;
                showSection('user-type-section');
                
                // Switch to login tab
                document.getElementById('login-tab').click();
                alert('Account created successfully! Please select your role and then login.');
            } else {
                alert('Please fill in all fields');
            }
        }
        
        // Email validation function
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        // Select user type (after signup)
        function selectUserType(type) {
            if (currentUser) {
                currentUser.type = type;
                currentUserType = type;
                
                // Update user in storage
                const userIndex = userAccounts.findIndex(acc => acc.email === currentUser.email);
                if (userIndex !== -1) {
                    userAccounts[userIndex].type = type;
                    localStorage.setItem('userAccounts', JSON.stringify(userAccounts));
                }
                
                // Update profile information
                updateProfileInfo();
                
                // Show login form
                showSection('auth-section');
                document.getElementById('login-tab').click();
            }
        }
        
        // Update profile information
        function updateProfileInfo() {
            if (currentUser) {
                document.getElementById('profile-name').textContent = currentUser.name;
                document.getElementById('profile-email').textContent = currentUser.email;
                document.getElementById('profile-phone').textContent = currentUser.phone || '+63 912 345 6789';
                document.getElementById('profile-address').textContent = currentUser.address || '123 Main Street, San Fernando, Pampanga';
                document.getElementById('profile-location').textContent = currentUser.location || 'San Fernando, Pampanga';
                document.getElementById('profile-about').textContent = currentUser.about || 'Experienced customer service professional with 5 years in the industry. Looking for new opportunities to grow and develop my skills.';
                document.getElementById('profile-role').textContent = currentUserType === 'applicant' ? 'Applicant' : 'Employee';
                
                // Update skills
                const skillsContainer = document.getElementById('profile-skills');
                skillsContainer.innerHTML = '';
                if (currentUser.skills && currentUser.skills.length > 0) {
                    currentUser.skills.forEach(skill => {
                        const skillTag = document.createElement('span');
                        skillTag.className = 'skill-tag';
                        skillTag.textContent = skill;
                        skillsContainer.appendChild(skillTag);
                    });
                } else {
                    skillsContainer.innerHTML = '<p>No skills added yet</p>';
                }
                
                // Update profile picture
                updateProfilePicture();
                
                // Update application form with user data
                document.getElementById('application-name').value = currentUser.name;
                document.getElementById('application-email').value = currentUser.email;
                document.getElementById('application-phone').value = currentUser.phone || '+63 912 345 6789';
                document.getElementById('application-address').value = currentUser.address || '123 Main Street, San Fernando, Pampanga';
            }
        }
        
        // Change job category
        function changeCategory(category) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update job cards
            currentCategory = category;
            populateJobCards(category);
        }
        
        // Change applicant filter
        function changeApplicantFilter(filter) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update applicant cards
            currentApplicantFilter = filter;
            populateApplicantCards(filter);
        }
        
        // Populate job cards based on category - FIXED VERSION
        function populateJobCards(category) {
            jobCardsContainer.innerHTML = '';
            
            const jobs = jobData[category] || [];
            
            jobs.forEach(job => {
                const jobCard = document.createElement('div');
                jobCard.className = 'job-card';
                
                // Check if user has already applied to this job - FIXED: Check if currentUser exists
                let hasApplied = false;
                if (currentUser && currentUser.email) {
                    hasApplied = Object.values(submittedApplications).some(app => 
                        app.position === job.title && app.company === job.company && app.email === currentUser.email
                    );
                }
                
                let applicationStatus = '';
                if (hasApplied) {
                    applicationStatus = `
                        <div class="application-status-badge status-applied">
                            <i class="fas fa-check-circle"></i> Applied
                        </div>
                    `;
                }
                
                jobCard.innerHTML = `
                    <div class="job-image" style="background-image: url('${job.image}');">
                        <div class="job-type">${job.type}</div>
                    </div>
                    <div class="job-content">
                        <div class="job-title">${job.title}</div>
                        <div class="company">${job.company}</div>
                        ${applicationStatus}
                        <div class="job-details">
                            <span><i class="fas fa-map-marker-alt"></i> ${job.location}</span>
                            <span><i class="fas fa-money-bill-wave"></i> ${job.salary}</span>
                        </div>
                        <button class="view-btn" onclick="showJobDetails('${job.id}')">
                            ${hasApplied ? 'Review Application' : 'View Job'}
                        </button>
                    </div>
                `;
                jobCardsContainer.appendChild(jobCard);
            });
        }
        
        // Populate applicant cards based on filter
        function populateApplicantCards(filter) {
            applicantsContainer.innerHTML = '';
            
            const applicants = applicantData[filter] || [];
            
            applicants.forEach(applicant => {
                const applicantCard = document.createElement('div');
                applicantCard.className = 'applicant-card';
                
                let statusClass = '';
                let statusText = '';
                
                switch(applicant.status) {
                    case 'pending':
                        statusClass = 'status-pending';
                        statusText = 'Pending Review';
                        break;
                    case 'approved':
                        statusClass = 'status-approved';
                        statusText = 'Approved';
                        break;
                    case 'rejected':
                        statusClass = 'status-rejected';
                        statusText = 'Rejected';
                        break;
                }
                
                applicantCard.innerHTML = `
                    <div class="applicant-header">
                        <div class="applicant-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="applicant-main-info">
                            <h3>${applicant.name}</h3>
                            <p>${applicant.position}</p>
                            <div class="application-status ${statusClass}">${statusText}</div>
                        </div>
                    </div>
                    <div class="applicant-details">
                        <p><strong>Experience:</strong> ${applicant.experience}</p>
                        <p><strong>Phone:</strong> ${applicant.phone}</p>
                        <p><strong>Email:</strong> ${applicant.email}</p>
                        <p><strong>Applied:</strong> ${applicant.appliedDate}</p>
                    </div>
                    <div class="applicant-skills">
                        ${applicant.skills.map(skill => `<span class="skill-tag">${skill}</span>`).join('')}
                    </div>
                    <div class="applicant-actions">
                        <button class="action-btn-small view-applicant-btn" onclick="viewApplicantDetails('${applicant.name}')">View Details</button>
                        <button class="action-btn-small save-applicant-btn" onclick="saveApplicant(this, '${applicant.name}')">Save</button>
                    </div>
                `;
                applicantsContainer.appendChild(applicantCard);
            });
        }
        
        // View applicant details
        function viewApplicantDetails(applicantName) {
            const applicant = applicantData.all.find(a => a.name === applicantName);
            if (applicant) {
                // Update the applicant details view
                document.getElementById('applicant-detail-name').textContent = applicant.name;
                document.getElementById('applicant-detail-email').textContent = applicant.email;
                document.getElementById('applicant-detail-phone').textContent = applicant.phone;
                document.getElementById('applicant-detail-address').textContent = applicant.address || 'Not provided';
                document.getElementById('applicant-detail-resume').textContent = applicant.resume || 'Not provided';
                
                // Update skills
                const skillsContainer = document.getElementById('applicant-detail-skills');
                skillsContainer.innerHTML = '';
                applicant.skills.forEach(skill => {
                    const skillTag = document.createElement('span');
                    skillTag.className = 'skill-tag';
                    skillTag.textContent = skill;
                    skillsContainer.appendChild(skillTag);
                });
                
                // Update education (in a real app, this would come from the applicant's profile)
                const educationContainer = document.getElementById('applicant-detail-education');
                educationContainer.innerHTML = `
                    <div class="education-item">
                        <div class="applicant-detail-label">Bachelor of Science in Business Administration</div>
                        <div class="applicant-detail-value">University of the Philippines, 2015-2019</div>
                    </div>
                `;
                
                // Update experience (in a real app, this would come from the applicant's profile)
                const experienceContainer = document.getElementById('applicant-detail-experience');
                experienceContainer.innerHTML = `
                    <div class="experience-item">
                        <div class="applicant-detail-label">Customer Service Representative</div>
                        <div class="applicant-detail-value">ABC Company, 2019-2021</div>
                        <div class="applicant-detail-value">Handled customer inquiries and resolved issues</div>
                    </div>
                    <div class="experience-item">
                        <div class="applicant-detail-label">Sales Associate</div>
                        <div class="applicant-detail-value">XYZ Retail, 2021-Present</div>
                        <div class="applicant-detail-value">Assisted customers and managed product displays</div>
                    </div>
                `;
                
                showSection('applicant-details-view');
            }
        }
        
        // Show job details - FIXED VERSION
        function showJobDetails(jobId) {
            const job = Object.values(jobData).flat().find(j => j.id === jobId);
            if (job) {
                // Check if user has already applied - FIXED: Check if currentUser exists
                let hasApplied = false;
                if (currentUser && currentUser.email) {
                    hasApplied = Object.values(submittedApplications).some(app => 
                        app.position === job.title && app.company === job.company && app.email === currentUser.email
                    );
                }
                
                // Update the apply button text
                const applyButton = document.querySelector('#job-details-view .view-btn');
                if (hasApplied) {
                    applyButton.textContent = 'Review Application';
                    applyButton.onclick = function() {
                        showApplicationDetails(jobId);
                    };
                } else {
                    applyButton.textContent = 'Apply Now';
                    applyButton.onclick = showApplicationForm;
                }
                
                showSection('job-details-view');
            }
        }
        
        // Show application form
        function showApplicationForm() {
            showSection('application-form-view');
        }
        
        // Submit application - FIXED VERSION
        function submitApplication() {
            // Check if user is logged in
            if (!currentUser) {
                alert('Please log in to submit an application');
                showSection('auth-section');
                return;
            }
            
            // Get values from the editable form
            const name = document.getElementById('application-name').value;
            const email = document.getElementById('application-email').value;
            const phone = document.getElementById('application-phone').value;
            const address = document.getElementById('application-address').value;
            const coverLetter = document.getElementById('application-cover-letter').value;
            const resumeName = currentApplicationResumeFile ? currentApplicationResumeFile.name : 'No resume uploaded';
            
            // Store application data
            const applicationId = 'app-' + Date.now();
            submittedApplications[applicationId] = {
                id: applicationId,
                name: name,
                email: email,
                phone: phone,
                address: address,
                coverLetter: coverLetter,
                resume: resumeName,
                position: "CUSTOMER SERVICE REPRESENTATIVE",
                company: "ALORICA",
                date: new Date().toLocaleDateString('en-PH', { year: 'numeric', month: 'long', day: 'numeric' }),
                status: "pending"
            };
            
            // Save to localStorage
            localStorage.setItem('submittedApplications', JSON.stringify(submittedApplications));
            
            // Create notification for employer
            createNotification(
                'employer@alorica.com', // In a real app, this would be the employer's email
                'New Application Received',
                `${name} has applied for the Customer Service Representative position.`
            );
            
            alert('Application submitted successfully!');
            showHomeSection();
            
            // Refresh job cards to show application status
            populateJobCards(currentCategory);
            
            // Refresh my applications view
            loadMyApplications();
        }
        
        // Load my applications for the applicant
        function loadMyApplications() {
            if (!currentUser) return;
            
            const myApplicationsContainer = document.getElementById('applicant-applications');
            if (!myApplicationsContainer) return;
            
            // Clear existing content except the title
            const title = myApplicationsContainer.querySelector('.section-title');
            myApplicationsContainer.innerHTML = '';
            if (title) {
                myApplicationsContainer.appendChild(title);
            }
            
            // Get applications for current user
            const userApplications = Object.values(submittedApplications).filter(app => 
                app.email === currentUser.email
            );
            
            if (userApplications.length === 0) {
                myApplicationsContainer.innerHTML += `
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <p>You haven't submitted any applications yet</p>
                        <button class="view-btn" onclick="showHomeSection()">Browse Jobs</button>
                    </div>
                `;
                return;
            }
            
            // Display user applications
            userApplications.forEach(application => {
                let statusClass = '';
                let statusText = '';
                
                switch(application.status) {
                    case 'pending':
                        statusClass = 'status-pending';
                        statusText = 'Pending Review';
                        break;
                    case 'approved':
                        statusClass = 'status-approved';
                        statusText = 'Approved';
                        break;
                    case 'rejected':
                        statusClass = 'status-rejected';
                        statusText = 'Rejected';
                        break;
                }
                
                const applicationCard = document.createElement('div');
                applicationCard.className = 'job-card';
                applicationCard.innerHTML = `
                    <div class="job-content">
                        <div class="job-title">${application.position}</div>
                        <div class="company">${application.company}</div>
                        <div class="application-status ${statusClass}">${statusText}</div>
                        <div class="job-details">
                            <span><i class="fas fa-calendar"></i> Applied on: ${application.date}</span>
                        </div>
                        <button class="view-btn" onclick="showApplicationDetails('${application.id}')">View Application</button>
                    </div>
                `;
                myApplicationsContainer.appendChild(applicationCard);
            });
        }
        
        // Show application details - FIXED VERSION
        function showApplicationDetails(applicationId) {
            const application = submittedApplications[applicationId];
            if (application) {
                // Update the application details view
                document.getElementById('detail-position').textContent = application.position;
                document.getElementById('detail-company').textContent = application.company;
                document.getElementById('detail-date').textContent = application.date;
                document.getElementById('detail-name').textContent = application.name;
                document.getElementById('detail-email').textContent = application.email;
                document.getElementById('detail-phone').textContent = application.phone;
                document.getElementById('detail-address').textContent = application.address;
                document.getElementById('detail-resume').textContent = application.resume;
                document.getElementById('detail-cover-letter').textContent = application.coverLetter;
                
                // Update status
                const statusElement = document.getElementById('detail-status');
                statusElement.textContent = application.status === 'pending' ? 'Pending Review' : 
                                           application.status === 'approved' ? 'Approved' : 'Rejected';
                statusElement.className = 'application-status ' + 
                    (application.status === 'pending' ? 'status-pending' : 
                     application.status === 'approved' ? 'status-approved' : 'status-rejected');
                
                showSection('application-details-view');
            }
        }
        
        // Edit profile - FIXED VERSION
        function editProfile() {
            // Check if user is logged in
            if (!currentUser) {
                alert('Please log in to edit your profile');
                showSection('auth-section');
                return;
            }
            
            document.getElementById('edit-name').value = currentUser.name || '';
            document.getElementById('edit-email').value = currentUser.email || '';
            document.getElementById('edit-phone').value = currentUser.phone || '+63 912 345 6789';
            document.getElementById('edit-address').value = currentUser.address || '123 Main Street, San Fernando, Pampanga';
            document.getElementById('edit-location').value = currentUser.location || 'San Fernando, Pampanga';
            document.getElementById('edit-about').value = currentUser.about || 'Experienced customer service professional with 5 years in the industry. Looking for new opportunities to grow and develop my skills.';
            
            // Populate skills
            const skillsContainer = document.getElementById('edit-skills');
            skillsContainer.innerHTML = '';
            if (currentUser.skills && currentUser.skills.length > 0) {
                currentUser.skills.forEach(skill => {
                    addSkillInput(skill);
                });
            }
            
            // Populate education
            const educationContainer = document.getElementById('edit-education');
            educationContainer.innerHTML = '';
            if (currentUser.education && currentUser.education.length > 0) {
                currentUser.education.forEach(edu => {
                    addEducationInput(edu);
                });
            }
            
            // Populate experience
            const experienceContainer = document.getElementById('edit-experience');
            experienceContainer.innerHTML = '';
            if (currentUser.experience && currentUser.experience.length > 0) {
                currentUser.experience.forEach(exp => {
                    addExperienceInput(exp);
                });
            }
            
            // Update profile picture in edit view
            const editProfileAvatar = document.getElementById('edit-profile-avatar');
            if (currentUser.profilePicture) {
                editProfileAvatar.innerHTML = `<img src="${currentUser.profilePicture}" class="profile-picture">`;
            } else {
                editProfileAvatar.innerHTML = `<i class="fas fa-user"></i>`;
            }
            
            showSection('edit-profile-view');
        }
        
        // Save profile - FIXED VERSION
        function saveProfile() {
            // Check if user is logged in
            if (!currentUser) {
                alert('Please log in to save your profile');
                showSection('auth-section');
                return;
            }
            
            // Update current user
            currentUser.name = document.getElementById('edit-name').value;
            currentUser.phone = document.getElementById('edit-phone').value;
            currentUser.address = document.getElementById('edit-address').value;
            currentUser.location = document.getElementById('edit-location').value;
            currentUser.about = document.getElementById('edit-about').value;
            
            // Update skills
            currentUser.skills = [];
            document.querySelectorAll('.skill-input').forEach(input => {
                if (input.value.trim() !== '') {
                    currentUser.skills.push(input.value.trim());
                }
            });
            
            // Update education
            currentUser.education = [];
            document.querySelectorAll('.education-item').forEach(item => {
                const degree = item.querySelector('.education-degree').value;
                const school = item.querySelector('.education-school').value;
                const year = item.querySelector('.education-year').value;
                
                if (degree.trim() !== '' && school.trim() !== '') {
                    currentUser.education.push({
                        degree: degree,
                        school: school,
                        year: year
                    });
                }
            });
            
            // Update experience
            currentUser.experience = [];
            document.querySelectorAll('.experience-item').forEach(item => {
                const position = item.querySelector('.experience-position').value;
                const company = item.querySelector('.experience-company').value;
                const duration = item.querySelector('.experience-duration').value;
                const description = item.querySelector('.experience-description').value;
                
                if (position.trim() !== '' && company.trim() !== '') {
                    currentUser.experience.push({
                        position: position,
                        company: company,
                        duration: duration,
                        description: description
                    });
                }
            });
            
            // Update in storage
            const userIndex = userAccounts.findIndex(acc => acc.email === currentUser.email);
            if (userIndex !== -1) {
                userAccounts[userIndex] = currentUser;
                localStorage.setItem('userAccounts', JSON.stringify(userAccounts));
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
            
            // Update profile display
            updateProfileInfo();
            
            alert('Profile updated successfully!');
            showSection('profile-view');
        }
        
        // Handle resume upload
        function handleResumeUpload(input) {
            if (input.files && input.files[0]) {
                currentResumeFile = input.files[0];
                
                // Create a preview of the resume
                const resumePreviewContainer = document.getElementById('profile-resume-preview');
                resumePreviewContainer.innerHTML = `
                    <div class="resume-preview-file">
                        <div>
                            <i class="fas fa-file-pdf"></i>
                            <span>${currentResumeFile.name}</span>
                        </div>
                        <div class="resume-actions">
                            <button class="resume-action-btn view-resume-btn" onclick="viewResumePreview()">View</button>
                            <button class="resume-action-btn remove-resume-btn" onclick="removeResumePreview()">Remove</button>
                        </div>
                    </div>
                `;
                
                alert('Resume uploaded successfully! You can view it before saving.');
            }
        }
        
        // Handle edit resume upload
        function handleEditResumeUpload(input) {
            if (input.files && input.files[0]) {
                currentResumeFile = input.files[0];
                
                // Create a preview of the resume
                const resumePreviewContainer = document.getElementById('edit-resume-preview');
                resumePreviewContainer.innerHTML = `
                    <div class="resume-preview-file">
                        <div>
                            <i class="fas fa-file-pdf"></i>
                            <span>${currentResumeFile.name}</span>
                        </div>
                        <div class="resume-actions">
                            <button class="resume-action-btn view-resume-btn" onclick="viewResumePreview()">View</button>
                            <button class="resume-action-btn remove-resume-btn" onclick="removeEditResumePreview()">Remove</button>
                        </div>
                    </div>
                `;
                
                alert('Resume uploaded successfully! You can view it before saving.');
            }
        }
        
        // Handle application resume upload
        function handleApplicationResumeUpload(input) {
            if (input.files && input.files[0]) {
                currentApplicationResumeFile = input.files[0];
                
                // Create a preview of the resume
                const resumePreviewContainer = document.getElementById('application-resume-preview');
                resumePreviewContainer.innerHTML = `
                    <div class="resume-preview-file">
                        <div>
                            <i class="fas fa-file-pdf"></i>
                            <span>${currentApplicationResumeFile.name}</span>
                        </div>
                        <div class="resume-actions">
                            <button class="resume-action-btn view-resume-btn" onclick="viewApplicationResumePreview()">View</button>
                            <button class="resume-action-btn remove-resume-btn" onclick="removeApplicationResumePreview()">Remove</button>
                        </div>
                    </div>
                `;
                
                alert('Resume updated successfully!');
            }
        }
        
        // FIXED: Added missing viewResume function
        function viewResume() {
            const resumeName = document.getElementById('applicant-detail-resume').textContent;
            if (resumeName && resumeName !== 'Not provided') {
                alert(`Opening resume: ${resumeName}`);
                // In a real app, you would open the actual resume file
            } else {
                alert('No resume available for this applicant');
            }
        }
        
        function viewResumePreview() {
            if (currentResumeFile) {
                // Create a URL for the file and open it in a new tab
                const fileURL = URL.createObjectURL(currentResumeFile);
                window.open(fileURL, '_blank');
            }
        }
        
        function viewApplicationResumePreview() {
            if (currentApplicationResumeFile) {
                // Create a URL for the file and open it in a new tab
                const fileURL = URL.createObjectURL(currentApplicationResumeFile);
                window.open(fileURL, '_blank');
            }
        }
        
        function removeResumePreview() {
            if (confirm('Are you sure you want to remove the resume?')) {
                currentResumeFile = null;
                document.getElementById('profile-resume-preview').innerHTML = `
                    <div class="file-upload" onclick="document.getElementById('resume-upload').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload your resume</p>
                    </div>
                `;
            }
        }
        
        function removeEditResumePreview() {
            if (confirm('Are you sure you want to remove the resume?')) {
                currentResumeFile = null;
                document.getElementById('edit-resume-preview').innerHTML = `
                    <div class="file-upload" onclick="document.getElementById('edit-resume-upload').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload your resume</p>
                    </div>
                `;
            }
        }
        
        function removeApplicationResumePreview() {
            if (confirm('Are you sure you want to remove the resume?')) {
                currentApplicationResumeFile = null;
                document.getElementById('application-resume-preview').innerHTML = `
                    <div class="file-upload" onclick="document.getElementById('application-resume-upload').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload your resume</p>
                    </div>
                `;
            }
        }
        
        // Profile Picture Functions
        function openCamera() {
            cameraModal.style.display = 'flex';
            
            // Access the camera
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    cameraStream = stream;
                    cameraPreview.srcObject = stream;
                })
                .catch(error => {
                    console.error('Error accessing camera:', error);
                    alert('Unable to access camera. Please check permissions.');
                });
        }
        
        function closeCamera() {
            cameraModal.style.display = 'none';
            
            // Stop the camera stream
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
        }
        
        function capturePhoto() {
            const canvas = document.createElement('canvas');
            canvas.width = cameraPreview.videoWidth;
            canvas.height = cameraPreview.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(cameraPreview, 0, 0, canvas.width, canvas.height);
            
            // Convert to data URL
            const dataURL = canvas.toDataURL('image/png');
            
            // Update profile picture
            currentUser.profilePicture = dataURL;
            updateProfilePicture();
            
            closeCamera();
        }
        
        function handleProfilePictureUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentUser.profilePicture = e.target.result;
                    updateProfilePicture();
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function updateProfilePicture() {
            const profileAvatar = document.getElementById('profile-avatar');
            const editProfileAvatar = document.getElementById('edit-profile-avatar');
            
            if (currentUser.profilePicture) {
                profileAvatar.innerHTML = `<img src="${currentUser.profilePicture}" class="profile-picture">`;
                if (editProfileAvatar) {
                    editProfileAvatar.innerHTML = `<img src="${currentUser.profilePicture}" class="profile-picture">`;
                }
            } else {
                profileAvatar.innerHTML = `<i class="fas fa-user"></i>`;
                if (editProfileAvatar) {
                    editProfileAvatar.innerHTML = `<i class="fas fa-user"></i>`;
                }
            }
        }
        
        // Form Input Functions
        function addSkillInput(value = '') {
            const skillsContainer = document.getElementById('edit-skills');
            const skillInput = document.createElement('div');
            skillInput.className = 'form-group';
            skillInput.innerHTML = `
                <input type="text" class="skill-input" placeholder="Enter a skill" value="${value}">
                <button class="action-btn remove-btn" onclick="this.parentElement.remove()">Remove</button>
            `;
            skillsContainer.appendChild(skillInput);
        }
        
        function addEducationInput(education = {}) {
            const educationContainer = document.getElementById('edit-education');
            const educationItem = document.createElement('div');
            educationItem.className = 'education-item';
            educationItem.innerHTML = `
                <div class="form-group">
                    <label>Degree</label>
                    <input type="text" class="education-degree" placeholder="e.g., Bachelor of Science in Business Administration" value="${education.degree || ''}">
                </div>
                <div class="form-group">
                    <label>School</label>
                    <input type="text" class="education-school" placeholder="e.g., University of the Philippines" value="${education.school || ''}">
                </div>
                <div class="form-group">
                    <label>Year</label>
                    <input type="text" class="education-year" placeholder="e.g., 2015-2019" value="${education.year || ''}">
                </div>
                <button class="action-btn remove-btn" onclick="this.parentElement.remove()">Remove</button>
            `;
            educationContainer.appendChild(educationItem);
        }
        
        function addExperienceInput(experience = {}) {
            const experienceContainer = document.getElementById('edit-experience');
            const experienceItem = document.createElement('div');
            experienceItem.className = 'experience-item';
            experienceItem.innerHTML = `
                <div class="form-group">
                    <label>Position</label>
                    <input type="text" class="experience-position" placeholder="e.g., Customer Service Representative" value="${experience.position || ''}">
                </div>
                <div class="form-group">
                    <label>Company</label>
                    <input type="text" class="experience-company" placeholder="e.g., ABC Company" value="${experience.company || ''}">
                </div>
                <div class="form-group">
                    <label>Duration</label>
                    <input type="text" class="experience-duration" placeholder="e.g., 2019-2021" value="${experience.duration || ''}">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea class="experience-description" placeholder="Describe your responsibilities and achievements" rows="3">${experience.description || ''}</textarea>
                </div>
                <button class="action-btn remove-btn" onclick="this.parentElement.remove()">Remove</button>
            `;
            experienceContainer.appendChild(experienceItem);
        }
        
        // Enhanced Save Applicant function
        function saveApplicant(button, applicantName) {
            const applicant = applicantData.all.find(a => a.name === applicantName);
            if (applicant) {
                // Check if already saved
                if (!savedApplicants.some(a => a.name === applicantName)) {
                    savedApplicants.push(applicant);
                    localStorage.setItem('savedApplicants', JSON.stringify(savedApplicants));
                    
                    // Create notification for applicant
                    createNotification(
                        applicant.email,
                        'Your application has been saved for interview',
                        `Your application for ${applicant.position} has been saved for interview consideration.`
                    );
                    
                    alert(`Applicant ${applicantName} saved for interviews!`);
                    
                    // Redirect to saved applicants page
                    showSection('saved-jobs-view');
                } else {
                    alert(`Applicant ${applicantName} is already saved.`);
                }
            }
        }
        
        // Save applicant for interview from details view
        function saveApplicantForInterview() {
            const applicantName = document.getElementById('applicant-detail-name').textContent;
            saveApplicant(null, applicantName);
        }
        
        // Approve applicant from details view
        function approveApplicant() {
            const applicantName = document.getElementById('applicant-detail-name').textContent;
            const applicant = applicantData.all.find(a => a.name === applicantName);
            if (applicant) {
                // Update status
                applicant.status = 'approved';
                
                // Create notification for applicant
                createNotification(
                    applicant.email,
                    'Application Approved',
                    `Your application for ${applicant.position} has been approved! We will contact you soon for the next steps.`
                );
                
                alert(`Application for ${applicantName} approved!`);
                
                // Redirect to employee view
                showSection('employee-view');
            }
        }
        
        // Reject applicant from details view
        function rejectApplicant() {
            const applicantName = document.getElementById('applicant-detail-name').textContent;
            const applicant = applicantData.all.find(a => a.name === applicantName);
            if (applicant) {
                // Update status
                applicant.status = 'rejected';
                
                // Create notification for applicant
                createNotification(
                    applicant.email,
                    'Application Status Update',
                    `Thank you for your application for ${applicant.position}. Unfortunately, we have decided to move forward with other candidates at this time.`
                );
                
                alert(`Application for ${applicantName} rejected!`);
                
                // Redirect to employee view
                showSection('employee-view');
            }
        }
        
        // Remove saved job (applicant)
        function removeSavedJob(button) {
            if (confirm('Are you sure you want to remove this saved job?')) {
                button.closest('.job-card').remove();
            }
        }
        
        // Remove saved applicant (employee)
        function removeSavedApplicant(button) {
            if (confirm('Are you sure you want to remove this saved applicant?')) {
                const applicantName = button.closest('.applicant-info').querySelector('.applicant-name').textContent;
                savedApplicants = savedApplicants.filter(a => a.name !== applicantName);
                localStorage.setItem('savedApplicants', JSON.stringify(savedApplicants));
                button.closest('.applicant-info').remove();
            }
        }
        
        // Show interview scheduling form
        function showScheduleInterview(applicantName, phoneNumber) {
            const applicant = applicantData.all.find(a => a.name === applicantName);
            if (applicant) {
                document.getElementById('interview-applicant').value = applicantName;
                document.getElementById('interview-phone').value = phoneNumber;
                document.getElementById('interview-email').value = applicant.email;
                
                // Update SMS preview
                updateSmsPreview();
                
                showSection('interview-scheduling-view');
            }
        }
        
        // Update SMS preview
        function updateSmsPreview() {
            const applicantName = document.getElementById('interview-applicant').value;
            const date = document.getElementById('interview-date').value;
            const time = document.getElementById('interview-time').value;
            const location = document.getElementById('interview-location').value;
            const interviewType = document.getElementById('interview-type').value;
            const details = document.getElementById('interview-details').value;
            
            const formattedDate = new Date(date).toLocaleDateString('en-PH', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            let smsContent = `Hello ${applicantName}, you have been scheduled for a ${interviewType} interview on ${formattedDate} at ${time}.`;
            
            if (location) {
                smsContent += ` Location: ${location}.`;
            }
            
            if (details) {
                smsContent += ` Additional details: ${details}`;
            }
            
            smsContent += " Please confirm your attendance. Thank you!";
            
            document.getElementById('sms-content').textContent = smsContent;
        }
        
        // Send interview invitation with EmailJS
        function sendInterviewInvitation() {
            const applicantName = document.getElementById('interview-applicant').value;
            const phoneNumber = document.getElementById('interview-phone').value;
            const email = document.getElementById('interview-email').value;
            const date = document.getElementById('interview-date').value;
            const time = document.getElementById('interview-time').value;
            const location = document.getElementById('interview-location').value;
            const interviewType = document.getElementById('interview-type').value;
            const details = document.getElementById('interview-details').value;
            
            if (!date || !time || !location) {
                alert('Please fill in all required fields: date, time, and location.');
                return;
            }
            
            // Show loading status
            integrationStatus.innerHTML = '<div class="integration-status integration-loading">Sending invitation...</div>';
            
            // Prepare email template parameters
            const templateParams = {
                to_name: applicantName,
                to_email: email,
                interview_date: new Date(date).toLocaleDateString('en-PH', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                }),
                interview_time: time,
                interview_location: location,
                interview_type: interviewType,
                additional_details: details,
                company_name: "EMPLOYMENT CORNER"
            };
            
            // Send email using EmailJS
            emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', templateParams)
                .then(function(response) {
                    console.log('SUCCESS!', response.status, response.text);
                    
                    // Show success status
                    integrationStatus.innerHTML = '<div class="integration-status integration-success">Interview invitation sent successfully to ' + email + '!</div>';
                    
                    // Remove from saved applicants
                    const applicant = savedApplicants.find(a => a.name === applicantName);
                    if (applicant) {
                        savedApplicants = savedApplicants.filter(a => a.name !== applicantName);
                        localStorage.setItem('savedApplicants', JSON.stringify(savedApplicants));
                    }
                    
                    // Add to scheduled interviews
                    const interview = {
                        applicantName: applicantName,
                        date: date,
                        time: time,
                        location: location,
                        type: interviewType
                    };
                    scheduledInterviews.push(interview);
                    localStorage.setItem('scheduledInterviews', JSON.stringify(scheduledInterviews));
                    
                    // Create notification for applicant
                    createNotification(
                        email,
                        'Interview Scheduled',
                        `You have been scheduled for a ${interviewType} interview on ${date} at ${time}. Location: ${location}.`
                    );
                    
                    // Show success message
                    alert(`Interview invitation sent to ${applicantName}!\n\nEmail: ${email}`);
                    
                    // Navigate back after a delay
                    setTimeout(() => {
                        showSection('saved-jobs-view');
                    }, 2000);
                }, function(error) {
                    console.log('FAILED...', error);
                    integrationStatus.innerHTML = '<div class="integration-status integration-error">Failed to send email. Please try again.</div>';
                });
        }
        
        // Real-time Notifications
        function createNotification(userEmail, title, message) {
            const notification = {
                id: Date.now(),
                userEmail: userEmail,
                title: title,
                message: message,
                timestamp: new Date(),
                read: false
            };
            
            notifications.push(notification);
            localStorage.setItem('notifications', JSON.stringify(notifications));
            
            // In a real app, you would use WebSockets or similar technology
            // to push notifications to the user in real-time
        }
        
        function loadNotifications() {
            if (!currentUser) return;
            
            const userNotifications = notifications.filter(n => n.userEmail === currentUser.email);
            const notificationList = document.getElementById('notification-list');
            notificationList.innerHTML = '';
            
            if (userNotifications.length > 0) {
                userNotifications.forEach(notification => {
                    const notificationItem = document.createElement('div');
                    notificationItem.className = 'notification-item';
                    if (!notification.read) {
                        notificationItem.classList.add('unread');
                    }
                    notificationItem.innerHTML = `
                        <div class="notification-title">${notification.title}</div>
                        <div class="notification-message">${notification.message}</div>
                        <div class="notification-time">${formatTime(notification.timestamp)}</div>
                    `;
                    notificationList.appendChild(notificationItem);
                });
            } else {
                notificationList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell-slash"></i>
                        <p>No notifications yet</p>
                    </div>
                `;
            }
        }
        
        // Enhanced Search Function
        function performSearch() {
            const searchTerm = document.querySelector('.search-input').value.toLowerCase();
            if (searchTerm) {
                // Filter jobs based on search term
                const allJobs = Object.values(jobData).flat();
                const filteredJobs = allJobs.filter(job => 
                    job.title.toLowerCase().includes(searchTerm) || 
                    job.company.toLowerCase().includes(searchTerm) ||
                    job.location.toLowerCase().includes(searchTerm)
                );
                
                // Display search results
                displaySearchResults(filteredJobs, searchTerm);
            } else {
                alert('Please enter a search term');
            }
        }
        
        function displaySearchResults(jobs, searchTerm) {
            // Create a search results view
            const searchResultsView = document.createElement('div');
            searchResultsView.className = 'search-results-container';
            searchResultsView.innerHTML = `
                <div class="page-header">
                    <div class="back-btn" onclick="showHomeSection()">
                        <i class="fas fa-arrow-left"></i>
                    </div>
                    <div class="logo">
                        <span>Search Results for "${searchTerm}"</span>
                    </div>
                    <div class="header-icons"></div>
                </div>
                <div class="job-cards" id="search-job-cards-container"></div>
            `;
            
            // Add to the app container
            document.querySelector('.app-container').appendChild(searchResultsView);
            
            // Populate with search results
            const searchJobCardsContainer = document.getElementById('search-job-cards-container');
            searchJobCardsContainer.innerHTML = '';
            
            if (jobs.length > 0) {
                jobs.forEach(job => {
                    const jobCard = document.createElement('div');
                    jobCard.className = 'job-card';
                    jobCard.innerHTML = `
                        <div class="job-image" style="background-image: url('${job.image}');">
                            <div class="job-type">${job.type}</div>
                        </div>
                        <div class="job-content">
                            <div class="job-title">${job.title}</div>
                            <div class="company">${job.company}</div>
                            <div class="job-details">
                                <span><i class="fas fa-map-marker-alt"></i> ${job.location}</span>
                                <span><i class="fas fa-money-bill-wave"></i> ${job.salary}</span>
                            </div>
                            <button class="view-btn" onclick="showJobDetails('${job.id}')">View Job</button>
                        </div>
                    `;
                    searchJobCardsContainer.appendChild(jobCard);
                });
            } else {
                searchJobCardsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>No jobs found for "${searchTerm}"</p>
                    </div>
                `;
            }
            
            // Show the search results view
            searchResultsView.style.display = 'block';
            hideAllSections();
        }
        
        function hideAllSections() {
            // Hide all main sections
            const sections = [
                'auth-section', 'user-type-section', 'applicant-view', 'employee-view',
                'my-applications-view', 'saved-jobs-view', 'profile-view', 'edit-profile-view',
                'job-details-view', 'application-form-view', 'interview-scheduling-view',
                'application-details-view', 'applicant-details-view'
            ];
            
            sections.forEach(section => {
                document.getElementById(section).classList.add('hidden');
            });
        }
        
        // Enhanced Chat System Functions
        function initChat() {
            // Event listeners for chat
            chatToggle.addEventListener('click', toggleChat);
            chatClose.addEventListener('click', toggleChat);
            chatSend.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        }
        
        function toggleChat() {
            if (chatContainer.style.display === 'flex') {
                chatContainer.style.display = 'none';
                currentChatWith = null;
            } else {
                // Show chat but don't load messages until a conversation is selected
                chatContainer.style.display = 'flex';
                document.querySelector('.chat-title').textContent = 'Select a conversation';
                chatMessagesEl.innerHTML = '<div class="empty-state"><p>Select an applicant to start chatting</p></div>';
            }
        }
        
        function loadChatMessages(applicantName) {
            chatMessagesEl.innerHTML = '';
            currentChatWith = applicantName;
            document.querySelector('.chat-title').textContent = `Chat with ${applicantName}`;
            
            // Get or create conversation
            if (!chatMessages[applicantName]) {
                chatMessages[applicantName] = [];
            }
            
            const conversation = chatMessages[applicantName];
            
            if (conversation.length === 0) {
                chatMessagesEl.innerHTML = '<div class="empty-state"><p>No messages yet. Start the conversation!</p></div>';
                return;
            }
            
            // Display messages
            conversation.forEach(msg => {
                const messageEl = document.createElement('div');
                messageEl.className = `message ${msg.sender === 'employer' ? 'sent' : 'received'}`;
                messageEl.innerHTML = `
                    <div class="message-text">${msg.text}</div>
                    <div class="message-time">${msg.time}</div>
                `;
                chatMessagesEl.appendChild(messageEl);
            });
            
            // Scroll to bottom
            chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
        }
        
        function sendMessage() {
            if (!currentChatWith) {
                alert('Please select an applicant to chat with first');
                return;
            }
            
            const messageText = chatInput.value.trim();
            if (messageText) {
                // Create message object
                const message = {
                    sender: 'employer',
                    text: messageText,
                    time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                };
                
                // Add to conversation
                if (!chatMessages[currentChatWith]) {
                    chatMessages[currentChatWith] = [];
                }
                chatMessages[currentChatWith].push(message);
                
                // Save to localStorage
                localStorage.setItem('chatMessages', JSON.stringify(chatMessages));
                
                // Create message element
                const messageEl = document.createElement('div');
                messageEl.className = 'message sent';
                messageEl.innerHTML = `
                    <div class="message-text">${messageText}</div>
                    <div class="message-time">${message.time}</div>
                `;
                chatMessagesEl.appendChild(messageEl);
                
                // Clear input
                chatInput.value = '';
                
                // Scroll to bottom
                chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
                
                // Simulate reply after a delay
                setTimeout(() => {
                    const replies = [
                        "Thank you for the information!",
                        "I'm interested in learning more about this opportunity.",
                        "When would be a good time to discuss further?",
                        "I appreciate you reaching out to me."
                    ];
                    const randomReply = replies[Math.floor(Math.random() * replies.length)];
                    
                    const replyMessage = {
                        sender: 'applicant',
                        text: randomReply,
                        time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                    };
                    
                    chatMessages[currentChatWith].push(replyMessage);
                    localStorage.setItem('chatMessages', JSON.stringify(chatMessages));
                    
                    const replyEl = document.createElement('div');
                    replyEl.className = 'message received';
                    replyEl.innerHTML = `
                        <div class="message-text">${randomReply}</div>
                        <div class="message-time">${replyMessage.time}</div>
                    `;
                    chatMessagesEl.appendChild(replyEl);
                    
                    // Scroll to bottom
                    chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
                }, 1000 + Math.random() * 2000);
            }
        }
        
        function startChatWithApplicant() {
            const applicantName = document.getElementById('applicant-detail-name').textContent;
            loadChatMessages(applicantName);
            toggleChat();
        }
        
        // Helper Functions
        function formatTime(date) {
            if (typeof date === 'string') {
                date = new Date(date);
            }
            return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        
        // Logout
        function logout() {
            currentUser = null;
            currentUserType = null;
            localStorage.removeItem('currentUser');
            showSection('auth-section');
        }
        
        // Google login/signup (simulated)
        function loginWithGoogle() {
            // In a real application, this would integrate with Google OAuth
            currentUser = {
                name: 'Juan Dela Cruz',
                email: 'juan.delacruz@example.com',
                type: 'applicant',
                phone: '+63 912 345 6789',
                address: '123 Main Street, San Fernando, Pampanga',
                location: 'San Fernando, Pampanga',
                about: 'Experienced customer service professional with 5 years in the industry. Looking for new opportunities to grow and develop my skills.',
                skills: ['Customer Service', 'Communication', 'Problem Solving'],
                education: [
                    { degree: 'Bachelor of Science in Business Administration', school: 'University of the Philippines', year: '2015-2019' }
                ],
                experience: [
                    { position: 'Customer Service Representative', company: 'ABC Company', duration: '2019-2021', description: 'Handled customer inquiries and resolved issues' }
                ],
                profilePicture: null
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            currentUserType = 'applicant';
            updateProfileInfo();
            showHomeSection();
        }
        
        function signupWithGoogle() {
            // In a real application, this would integrate with Google OAuth
            showSection('user-type-section');
        }
        
        // Event listeners for form inputs to update SMS preview
        document.getElementById('interview-date').addEventListener('change', updateSmsPreview);
        document.getElementById('interview-time').addEventListener('change', updateSmsPreview);
        document.getElementById('interview-location').addEventListener('input', updateSmsPreview);
        document.getElementById('interview-type').addEventListener('change', updateSmsPreview);
        document.getElementById('interview-details').addEventListener('input', updateSmsPreview);
        document.getElementById('interview-phone').addEventListener('input', updateSmsPreview);
        
        // Event listeners for UI elements
        document.getElementById('notification-icon').addEventListener('click', function() {
            notificationPanel.style.display = notificationPanel.style.display === 'block' ? 'none' : 'block';
            searchPanel.style.display = 'none';
        });
        
        document.getElementById('search-icon').addEventListener('click', function() {
            searchPanel.style.display = searchPanel.style.display === 'block' ? 'none' : 'block';
            notificationPanel.style.display = 'none';
        });
        
        document.getElementById('login-tab').addEventListener('click', function() {
            document.getElementById('login-tab').classList.add('active');
            document.getElementById('signup-tab').classList.remove('active');
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('signup-form').classList.add('hidden');
        });
        
        document.getElementById('signup-tab').addEventListener('click', function() {
            document.getElementById('signup-tab').classList.add('active');
            document.getElementById('login-tab').classList.remove('active');
            document.getElementById('signup-form').classList.remove('hidden');
            document.getElementById('login-form').classList.add('hidden');
        });
        
        document.addEventListener('click', function(event) {
            if (!event.target.closest('#notification-icon') && !event.target.closest('#notification-panel')) {
                notificationPanel.style.display = 'none';
            }
            
            if (!event.target.closest('#search-icon') && !event.target.closest('#search-panel')) {
                searchPanel.style.display = 'none';
            }
        });
        
        // Initialize the application
        init();
    </script>
</body>
</html>